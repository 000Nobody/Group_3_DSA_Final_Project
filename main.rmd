---
title: "main"
output: html_document
date: "2023-07-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pacman::p_load(dplyr, ggplot2, glmnet, tidyverse, janitor)
```

**Starting by importing and cleaning data**

```{r}
data <- read.csv("data/MA_Public_Schools_2017.csv")

# Remove MCAS, AP columns
data_hs <- data[, -c(98:293, 80:93)]

# Select only high schools, create total_sat column, remove NAs and blank vals, clean column names
data_hs <- data_hs %>% 
  filter(
    Grade == "09,10,11,12"
  ) %>% 
  select(-c(
    Function, 
    State, 
    Address.2, 
    Phone, 
    Fax, 
    Contact.Name, 
    School.Code)
  ) %>%
  mutate(total_sat = (
    Average.SAT_Math + Average.SAT_Reading + Average.SAT_Writing) * (2/3)
  ) %>% 
  remove_empty(which = c("cols", "rows")) %>% 
  drop_na() %>%
  clean_names()

names(data_hs)
```

**Basic EDA**

```{r}
depend_vars <- data_hs %>% 
  summarise(name = school_name, sat = total_sat, grad_rate = x_graduated, college_rate = x_attending_college)

# Graphing the distribution of dependent variables
depend_vars %>% ggplot(aes(x = sat)) + 
  geom_histogram(bins = 20, fill = "blue", col = "black") + 
  labs(title = "Average SAT Histogram", x = "Average SAT Score", y = "Frequency")

depend_vars %>% ggplot(aes(x = grad_rate)) + 
  geom_histogram(bins = 50, fill = "blue", col = "black") + 
  labs(title = "Graduation Rate Histogram")

depend_vars %>% ggplot(aes(x = college_rate)) + 
  geom_histogram(bins = 30, fill = "blue", col = "black") + 
  labs(title = "College Attendance Rate Histogram")
```

**LASSO Model for SAT**

```{r}
indep_vars <- data_hs %>% select(-c(
  school_name,
  grade,
  address_1
)) %>% 
  mutate_if(is.character, as.factor)

X <- as.matrix(indep_vars[, c("average_salary", "sat_tests_taken", "number_of_students")])
Y.sat <- indep_vars$total_sat

lasso_sat <- cv.glmnet(x = X, y = Y.sat, alpha = .99)

plot(lasso_sat)
summary(lasso_sat)
```
